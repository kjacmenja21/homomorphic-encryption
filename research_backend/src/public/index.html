<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WebSocket Terminal</title>
    <style>
      body {
        background-color: #f4f4f4;
        color: #333;
        font-family: monospace;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      #terminal {
        width: 80%;
        height: 70%;
        background: #fff;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      #header {
        background: #e0e0e0;
        padding: 5px 10px;
        display: flex;
        align-items: center;
        border-bottom: 1px solid #ccc;
      }

      .button {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }

      .close {
        background: #ff5f56;
      }

      .minimize {
        background: #ffbd2e;
      }

      .maximize {
        background: #27c93f;
      }

      #output {
        flex: 1;
        padding: 10px;
        overflow-y: auto;
        background: #f9f9f9;
        font-size: 14px;
      }

      #terminal input {
        width: 100%;
        padding: 10px;
        border: none;
        border-top: 1px solid #ccc;
        outline: none;
        font-family: monospace;
        font-size: 14px;
      }

      .line {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <div id="terminal">
      <div id="header">
        <div class="button close"></div>
        <div class="button minimize"></div>
        <div class="button maximize"></div>
      </div>
      <div id="output"></div>
      <input type="text" id="input" autofocus placeholder="Type a command..." />
    </div>

    <script>
      // Injected host and port
      const HOST = __HOST__;
      const PORT = __PORT__;

      const WEBSOCKET = `ws://${HOST}:${PORT}`;

      console.log(WEBSOCKET);

      // WebSocket setup
      const socket = new WebSocket(WEBSOCKET);
      const outputDiv = document.getElementById("output");
      const inputField = document.getElementById("input");

      // Add message to terminal output
      function appendMessage(message) {
        const line = document.createElement("div");
        line.className = "line";
        line.textContent = message;
        outputDiv.appendChild(line);
        outputDiv.scrollTop = outputDiv.scrollHeight; // Scroll to bottom
      }

      // WebSocket events
      socket.addEventListener("open", () => {
        appendMessage("[Connected to server]");
      });

      socket.addEventListener("message", (event) => {
        appendMessage(event.data);
      });

      socket.addEventListener("close", () => {
        appendMessage("[Disconnected from server]");
      });

      socket.addEventListener("error", (error) => {
        appendMessage(`[Error: ${error.message}]`);
      });

      // Handle user input
      inputField.addEventListener("keydown", (event) => {
        if (event.key === "Enter") {
          const command = inputField.value.trim();
          if (command) {
            appendMessage(`> ${command}`); // Show the user input
            socket.send(command); // Send command to WebSocket server
            inputField.value = ""; // Clear input field
          }
        }
      });
    </script>
  </body>
</html>
